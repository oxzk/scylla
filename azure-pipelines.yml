# Azure Pipelines configuration for Scylla Proxy Pool
# Runs CLI validation task on a schedule

trigger: none

schedules:
  - cron: "*/15 * * * *"
    displayName: Proxy Validation Schedule
    branches:
      include:
        - main
    always: "true"

pool:
  vmImage: "ubuntu-latest"

variables:
  PYTHON_VERSION: "3.11"
  group: scylla

jobs:
  - job: build
    timeoutInMinutes: "30"

    steps:
      - task: UsePythonVersion@0
        displayName: "Set Python version"
        inputs:
          versionSpec: "$(PYTHON_VERSION)"
          addToPath: true

      - script: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
        displayName: "Install dependencies"

      - script: |
          python cli.py
        displayName: "Run proxy validation CLI"
        env:
          # DB_URL: $(SCDB_URL)
          VALIDATE_BATCH_LIMIT: 500
        # continueOnError: "true"

      - script: |
          echo "Validation task completed"
        displayName: "Cleanup"
        condition: always()
